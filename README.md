# Tutorial for https://github.com/shakacode/react-webpack-rails-tutorial/

In branches of this repository you'll find intermediate demos in the 
construction of a demo for `react_on_rails` similar to 
<https://github.com/shakacode/react-webpack-rails-tutorial/>.

(The idea of branches comes from 
<https://github.com/thoughtbot/hotwire-example-template> )

In this branch you find the complete demo.  The intermediate branches are:

* `1-classic` the classic demo, i.e just wiht rails generating almost 
   everything with scaffold and minor adjustment but without style
* `2-bootstrap` adding shakapacker, bootstrap and loading the SCSS of 
   bootstrap


# How to run this demo

## Requirements

* Ruby 2.7 or above (suggested the most recent i.e 3.1)
* PostgreSQL 9.7 or above (suggested the most recent i.e 14.2) 
  with a user that can create databases
* node 16.13 or above


## Procedure

* With the PostgreSQL create the database :
```
createdb -U pguser tutorial_rwrt
```
* Run 
```
bundle
```
* Configure PostgreSQL user and password in the application
  ```
  cp env.template .env
  $EDITOR .env
  ```
  Set user, password and if needed host option for PostgreSQL in `DB_USER`, 
  `DB_PASSWORD` and `DB_HOST` respectively.
* Populate the database with
  ```
  bin/rails db:setup
  ```
  and optionaly check that you can use it with
  ```
  bin/rails dbconsole
  ```
* Run `yarn`
* Run the example
  ```
  bin/rails s
  ```
* See results in your browser by opening http://127.0.0.1/comments


## Tests

* Run 
  ```
  CONFIG_HOSTS=www.example.com bin/rails test
  ```

# How we created this example

* Check previous steps in branch `1-classic`

* Add shakapacer:
```
bundle add shakapacker --strict
bundle
bin/rails webpacker:install
```
* Adjusting package.json
* Adding bootstrap

```
yarn add @popperjs/core
yarn add bootstrap
```
* Creating `app/javascript/application.js` by loading the 
  javascript of bootstrap

* Adapt `Procfile.dev` from `react-webpack-rails-tutorial` and preparing
  configuration for `webpacker-dev-server` in `.env` (to run not only in
  localhost:3035)

* Allow loading CSS with Javascript and enabling sass following 
  documentation of shakapacker: 
  *  Adding packages
     ```
     yarn add css-loader style-loader mini-css-extract-plugin \
       css-minimizer-webpack-plugin
     yarn add sass sass-loader
     ```
     According to shakapacker documentation `style-loader` is needed only
     when `inline_css` is true --and it works but we prefer by default
     `inline_css` in false.
  * Configuring loader for webpack by editing 
    `config/webpack/webpack.config.js` as docummented in shakapacker README:
    ```js
    const { webpackConfig, merge } = require('shakapacker')

    // See the shakacode/shakapacker README and docs directory for advice on customizing your webpackConfig.

    const customConfig = {
      resolve: {
        extensions: ['.css']
      }
    }

    module.exports = merge(webpackConfig, customConfig)
    ```
  * Modifying `app/views/layout/application.html` to make sure it will load
  the CSS generated by using shakapacker helper:
    ```js
    <%= stylesheet_pack_tag "application.css" %>
    ```

* Creating `app/javascript/stylesheets/application.scss` to load 
  bootstrap.  We prefer  a directory inside 
  `app/javascript` because must be referenced from
  `app/javascript/application.js` 
  ```scss
  @import "bootstrap/scss/bootrap";
  ```

* Importing `application.scss` in the main entrypoint 
  `app/javascript/application.js`. This way webpack will generate 
  `public/packs/css/application.css` (try by running `bin/webpacker`)

* Copy SCSSs from rwrt in `app/javascripts/assets/stylesheets`,
  font used in `app/javascript/assets/fonts`, adapting and loading
  from `app/javascript/stylesheets/application.scss`

* Fixing problems of the imported styles with bootstrap 5:

```
SassError: 22.5px and 1rem have incompatible units.
1116 │ $nav-link-height:                   $font-size-base * $line-height-base +
$nav-link-padding-y * 2 !default;
     │
     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
```

* Adding script `bin/rundev` and `bin/stopdev`
